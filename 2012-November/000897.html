<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cdrecord-support] mkisofs - Invalid rock ridge data with file in appended session with CE record past 4GB
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cdrecord-support/2012-November/index.html" >
   <LINK REL="made" HREF="mailto:cdrecord-support%40lists.berlios.de?Subject=Re%3A%20%5BCdrecord-support%5D%20mkisofs%20-%20Invalid%20rock%20ridge%20data%20with%20file%0A%20in%20appended%20session%20with%20CE%20record%20past%204GB&In-Reply-To=%3Cxp6nkdgs2kxberhd1wd3vlvr.1354269184038%40email.android.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000896.html">
   <LINK REL="Next"  HREF="000898.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cdrecord-support] mkisofs - Invalid rock ridge data with file in appended session with CE record past 4GB</H1>
    <B>Schilling, J&#246;rg</B> 
    <A HREF="mailto:cdrecord-support%40lists.berlios.de?Subject=Re%3A%20%5BCdrecord-support%5D%20mkisofs%20-%20Invalid%20rock%20ridge%20data%20with%20file%0A%20in%20appended%20session%20with%20CE%20record%20past%204GB&In-Reply-To=%3Cxp6nkdgs2kxberhd1wd3vlvr.1354269184038%40email.android.com%3E"
       TITLE="[Cdrecord-support] mkisofs - Invalid rock ridge data with file in appended session with CE record past 4GB">joerg.schilling at fokus.fraunhofer.de
       </A><BR>
    <I>Fri Nov 30 10:55:37 CET 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="000896.html">[Cdrecord-support] mkisofs - Invalid rock ridge data with file in appended session with CE record past 4GB
</A></li>
        <LI>Next message: <A HREF="000898.html">[Cdrecord-support] mkisofs - Invalid rock ridge data with file	in appended session with CE record past 4GB
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#897">[ date ]</a>
              <a href="thread.html#897">[ thread ]</a>
              <a href="subject.html#897">[ subject ]</a>
              <a href="author.html#897">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

please test the preliminary tar archive I put out on the ftp directory yesterday

--
Send from my Android phone

Omega Weapon &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/cdrecord-support">omegaphil at gmail.com</A>&gt; schrieb:


On 29/11/12 14:28, Joerg Schilling wrote:
&gt;<i> Omega Weapon&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/cdrecord-support">omegaphil at gmail.com</A>&gt;  wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> /opt/schily/bin/mkisofs --version
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> mkisofs 3.01a07 (x86_64-unknown-linux-gnu) Copyright (C) 1993-1997 Eric
</I>&gt;&gt;<i> Youngdale (C) 1997-2010 Joerg Schilling
</I>&gt;<i>
</I>&gt;<i> You should update to get correct ISO-9660-PVDs
</I>&gt;<i>
</I>&gt;&gt;<i> Debian Wheezy (Testing), Linux omega1 3.2.0-4-amd64 #1 SMP Debian
</I>&gt;&gt;<i> 3.2.32-1 x86_64 GNU/Linux
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I received the following error on generating an isofs to append to a
</I>&gt;&gt;<i> multisession BD-R disc:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> =====================================================================
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Setting input-charset to 'UTF-8' from locale.
</I>&gt;&gt;<i> ISO-9660 image includes checksum signature for correct inode numbers.
</I>&gt;&gt;<i> SUSP signatures version 1 found
</I>&gt;&gt;<i> Rock Ridge signatures version 1 found
</I>&gt;&gt;<i> Rock Ridge id 'RRIP_1991A'
</I>&gt;&gt;<i> BAD RR ATTRIBUTES: 11 A2 07 4A 3D 88 93 69 A5 CD 37 52 71 FD 97 71 B9 FE
</I>&gt;&gt;<i> 78 BE 03 E4 FA B0 C1 26
</I>&gt;&gt;<i> BAD RR ATTRIBUTES: ...J=..i..7Rq..q..x......&amp;
</I>&gt;&gt;<i> mkisofs: **BAD RRVERSION (74) in '???' field (11 A2).
</I>&gt;&gt;<i> mkisofs: Cannot parse Rock Ridge attributes for
</I>&gt;&gt;<i> 'MERI_VEGETTOEX___EVA___OBL.MPEG;1RR???NMd'.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> =====================================================================
</I>&gt;<i>
</I>&gt;<i> A lot of information is missing here. Without that information, I cannot help.
</I>&gt;<i>
</I>&gt;<i> -     how do you read the old image?
</I>&gt;<i>
</I>&gt;<i> -     what software created the first session?
</I>&gt;<i>
</I>&gt;<i> -     where is the ISO-9660+RR metadata?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> The file in question it was referring to exits at '/Neon Genesis
</I>&gt;&gt;<i> Evangelion AMVs/meri_vegettoex___eva___obl.mpeg'.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The actual filename is 'Meri VegettoEX - EVA - Obligatory EVA Trailer -
</I>&gt;&gt;<i> Deep Blue Sea Trailer Piss Take [00359A73].mpeg', and the session was
</I>&gt;&gt;<i> also generated by the following mkisofs call (taken from the bash script
</I>&gt;&gt;<i> I use, which works):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> =======================================================================
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> /opt/schily/bin/mkisofs -volid &quot;$volumeID&quot; -rational-rock
</I>&gt;&gt;<i> -full-iso9660-filenames -iso-level 3 -follow-links -C &quot;$(cdrskin
</I>&gt;&gt;<i> -dev=&quot;$burner&quot; -msinfo)&quot; -M &quot;$burner&quot; -o &quot;$masteredImageOutput&quot;
</I>&gt;&gt;<i> &quot;$directoryToMaster&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> =======================================================================
</I>&gt;<i>
</I>&gt;<i> It seems that you use a program (cdrskin) that is not known to be bugfree.
</I>&gt;<i>
</I>&gt;&gt;<i> Mounting the disc normally also produces the non-Rock Ridge filename and
</I>&gt;&gt;<i> apparently no complaints from the isofs driver, however xorriso
</I>&gt;&gt;<i> (<A HREF="https://www.gnu.org/software/xorriso/">https://www.gnu.org/software/xorriso/</A>) is able to list the directory
</I>&gt;&gt;<i> and show the correct name.
</I>&gt;<i>
</I>&gt;<i> xorriso is known to be not fully correct and not fully complete with respect to
</I>&gt;<i> RR.
</I>&gt;<i>
</I>&gt;&gt;<i> Talking to the xorriso programmer over what might be happening, he
</I>&gt;&gt;<i> reckons that due to the long filename, a CE entry is created - this
</I>&gt;&gt;<i> should point to a block after 3066496, but actually points to block
</I>&gt;&gt;<i> 969372 which is a data block in the first session.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> He also notes that the ISO 9660 filename does not end after 33
</I>&gt;&gt;<i> characters in the above error, even though the length of 33 is correctly
</I>&gt;&gt;<i> stored in the ISO 9660 directory record.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> xorriso toc output (I have added sessions beyond 3 to try to fix the
</I>&gt;&gt;<i> filename):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ======================================================================
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Drive current: -dev '/dev/sr0'
</I>&gt;&gt;<i> Drive type   : vendor 'ATAPI' product 'iHBS112 2' revision 'PL05'
</I>&gt;&gt;<i> Media current: BD-R sequential recording
</I>&gt;&gt;<i> Media product: JVC-AMS6/S6L/1 , JVC Limited
</I>&gt;&gt;<i> Media status : is written , is appendable
</I>&gt;&gt;<i> Media blocks : 3183328 readable , 9036064 writable , 12219392 overall
</I>&gt;&gt;<i> TOC layout   : Idx ,  sbsector ,       Size , Volume Id
</I>&gt;&gt;<i> ISO session  :   1 ,         0 ,   2899354s , ADN70
</I>&gt;&gt;<i> ISO session  :   2 ,   2899360 ,    167112s , ADN70
</I>&gt;&gt;<i> ISO session  :   3 ,   3066496 ,    116436s , ADN70
</I>&gt;&gt;<i> ISO session  :   4 ,   3182944 ,        36s , ADN70
</I>&gt;&gt;<i> ISO session  :   5 ,   3183136 ,        36s , ADN70
</I>&gt;&gt;<i> Media summary: 5 sessions, 3183328 data blocks, 6217m data, 17.2g free
</I>&gt;&gt;<i> Media nwa    : 3183328s
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ======================================================================
</I>&gt;<i>
</I>&gt;<i> What do you get from cdrecord -minfo?
</I>&gt;<i>
</I>&gt;&gt;<i> I passed the metadata of the third session to the programmer and he
</I>&gt;&gt;<i> reported:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ======================================================================
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The bad CE entry says:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     43  45  1c  01  9c  ca  0e  00  00  0e  ca  9c  00  00  00  00
</I>&gt;&gt;<i>     00  00  00  00  1a  00  00  00  00  00  00  1a
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The number 0x000eca9c is the block address (decimal 969,372) where
</I>&gt;&gt;<i> the TF field is supposed to be stored. But the session begins
</I>&gt;&gt;<i> only above the 3 millionth block. So the address below 1 million
</I>&gt;&gt;<i> must be wrong.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I suspect it is a 32 bit byte address rollover:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2 exp 32 bytes is 4294967296 = 2097152 blocks of 2048.
</I>&gt;&gt;<i> session start 3066496 - wrong block number 969372 = 2097124.
</I>&gt;&gt;<i> This differs by 28 blocks. That's within our 40 blocks of
</I>&gt;&gt;<i> meta data.
</I>&gt;<i>
</I>&gt;<i> This may be true. The related code has been written by Eric Youngdale in 1995,
</I>&gt;<i> this is before DVDs appeared and I fixed a lot of bugs in the RR Code in 2006
</I>&gt;<i> already, so there may be more. So far however, nobody reported a single RR bug
</I>&gt;<i> since 2006.
</I>&gt;<i>
</I>&gt;<i> I need to make some tests - stay tuned.
</I>&gt;<i>
</I>&gt;&gt;<i> ======================================================================
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> He has also done a thorough investigation on whether xorriso's ability
</I>&gt;&gt;<i> to cope with the bad CE entry is valid (i.e. should it fail with an
</I>&gt;&gt;<i> error?), and some more testing with long filenames:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ======================================================================
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am examining the libisofs behaviour with the bad CE entry
</I>&gt;&gt;<i> produced by mkisofs.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Well, the behaviour is covered by the fundamental Rock Ridge
</I>&gt;&gt;<i> rule &quot;Reader does it right&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Explicitly SUSP 1.12 states:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &quot;Any System Use Entry which the receiving system does not
</I>&gt;&gt;<i>     recognize shall be ignored and skipped.&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The CE entry leads to data content of a file. The first few
</I>&gt;&gt;<i> bytes of that block do not constitute a recognizable System
</I>&gt;&gt;<i> Use Entry (Rock Ridge field).
</I>&gt;&gt;<i> So it shall be ignored. And that is what libisofs does.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If the filename is 120 characters long, then not only the
</I>&gt;&gt;<i> timestamp field TF is stored in a continuation record,
</I>&gt;&gt;<i> but also field PX, which holds POSIX permissions.
</I>&gt;&gt;<i> This field is regarded by libisofs as mandatory if Rock
</I>&gt;&gt;<i> Ridge shall be loaded.
</I>&gt;<i>
</I>&gt;<i> Did you test this with a mount on Solaris?
</I>&gt;<i>
</I>&gt;<i> The expected behavior is to assume default permissions in case that PX is
</I>&gt;<i> missing.
</I>&gt;<i>
</I>&gt;&gt;<i> So with a filename of 120 characters, xorriso will fail
</I>&gt;&gt;<i> on the attempt to load the image:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>      $ echo something&gt;/tmp/x
</I>&gt;&gt;<i>      $ mkisofs -o /tmp/x.iso -iso-level 3 -graft-points -R
</I>&gt;&gt;<i> 1234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890=/tmp/x
</I>&gt;&gt;<i>      ...
</I>&gt;&gt;<i>      $ xorriso -indev /tmp/x.iso
</I>&gt;&gt;<i>      ...
</I>&gt;&gt;<i>      libisofs: SORRY : Mandatory Rock Ridge PX entry is not present or it
</I>&gt;&gt;<i> contains invalid values.
</I>&gt;&gt;<i>      libisofs: SORRY : Can't open dir
</I>&gt;&gt;<i>      libisofs: NOTE :&gt;   Caused by: Operation canceled
</I>&gt;&gt;<i>      libisofs: FAILURE : Operation canceled
</I>&gt;<i>
</I>&gt;<i> This looks like a bug.
</I>&gt;<i>
</I>&gt;<i> J&#246;rg
</I>&gt;<i>
</I>
For reference, a reply was sent yesterday with attached session
metadata, but was held back by the mailing list complaining it was over
40KB (...). J&#246;rg should have the email separately as well.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000896.html">[Cdrecord-support] mkisofs - Invalid rock ridge data with file in appended session with CE record past 4GB
</A></li>
	<LI>Next message: <A HREF="000898.html">[Cdrecord-support] mkisofs - Invalid rock ridge data with file	in appended session with CE record past 4GB
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#897">[ date ]</a>
              <a href="thread.html#897">[ thread ]</a>
              <a href="subject.html#897">[ subject ]</a>
              <a href="author.html#897">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cdrecord-support">More information about the Cdrecord-support
mailing list</a><br>
</body></html>
