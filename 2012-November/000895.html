<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cdrecord-support] mkisofs - Invalid rock ridge data with file	in appended session with CE record past 4GB
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cdrecord-support/2012-November/index.html" >
   <LINK REL="made" HREF="mailto:cdrecord-support%40lists.berlios.de?Subject=Re%3A%20%5BCdrecord-support%5D%20mkisofs%20-%20Invalid%20rock%20ridge%20data%20with%20file%0A%09in%20appended%20session%20with%20CE%20record%20past%204GB&In-Reply-To=%3C50b77108.GlktqAvHheRx1TnS%25Joerg.Schilling%40fokus.fraunhofer.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000894.html">
   <LINK REL="Next"  HREF="000896.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cdrecord-support] mkisofs - Invalid rock ridge data with file	in appended session with CE record past 4GB</H1>
    <B>Joerg Schilling</B> 
    <A HREF="mailto:cdrecord-support%40lists.berlios.de?Subject=Re%3A%20%5BCdrecord-support%5D%20mkisofs%20-%20Invalid%20rock%20ridge%20data%20with%20file%0A%09in%20appended%20session%20with%20CE%20record%20past%204GB&In-Reply-To=%3C50b77108.GlktqAvHheRx1TnS%25Joerg.Schilling%40fokus.fraunhofer.de%3E"
       TITLE="[Cdrecord-support] mkisofs - Invalid rock ridge data with file	in appended session with CE record past 4GB">Joerg.Schilling at fokus.fraunhofer.de
       </A><BR>
    <I>Thu Nov 29 15:28:24 CET 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="000894.html">[Cdrecord-support] mkisofs - Invalid rock ridge data with file in appended session with CE record past 4GB
</A></li>
        <LI>Next message: <A HREF="000896.html">[Cdrecord-support] mkisofs - Invalid rock ridge data with file in appended session with CE record past 4GB
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#895">[ date ]</a>
              <a href="thread.html#895">[ thread ]</a>
              <a href="subject.html#895">[ subject ]</a>
              <a href="author.html#895">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Omega Weapon &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/cdrecord-support">omegaphil at gmail.com</A>&gt; wrote:

&gt;<i> /opt/schily/bin/mkisofs --version
</I>&gt;<i>
</I>&gt;<i> mkisofs 3.01a07 (x86_64-unknown-linux-gnu) Copyright (C) 1993-1997 Eric 
</I>&gt;<i> Youngdale (C) 1997-2010 Joerg Schilling
</I>
You should update to get correct ISO-9660-PVDs

&gt;<i> Debian Wheezy (Testing), Linux omega1 3.2.0-4-amd64 #1 SMP Debian 
</I>&gt;<i> 3.2.32-1 x86_64 GNU/Linux
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I received the following error on generating an isofs to append to a 
</I>&gt;<i> multisession BD-R disc:
</I>&gt;<i>
</I>&gt;<i> =====================================================================
</I>&gt;<i>
</I>&gt;<i> Setting input-charset to 'UTF-8' from locale.
</I>&gt;<i> ISO-9660 image includes checksum signature for correct inode numbers.
</I>&gt;<i> SUSP signatures version 1 found
</I>&gt;<i> Rock Ridge signatures version 1 found
</I>&gt;<i> Rock Ridge id 'RRIP_1991A'
</I>&gt;<i> BAD RR ATTRIBUTES: 11 A2 07 4A 3D 88 93 69 A5 CD 37 52 71 FD 97 71 B9 FE 
</I>&gt;<i> 78 BE 03 E4 FA B0 C1 26
</I>&gt;<i> BAD RR ATTRIBUTES: ...J=..i..7Rq..q..x......&amp;
</I>&gt;<i> mkisofs: **BAD RRVERSION (74) in '???' field (11 A2).
</I>&gt;<i> mkisofs: Cannot parse Rock Ridge attributes for 
</I>&gt;<i> 'MERI_VEGETTOEX___EVA___OBL.MPEG;1RR???NMd'.
</I>&gt;<i>
</I>&gt;<i> =====================================================================
</I>
A lot of information is missing here. Without that information, I cannot help.

-	how do you read the old image?

-	what software created the first session?

-	where is the ISO-9660+RR metadata?


&gt;<i> The file in question it was referring to exits at '/Neon Genesis 
</I>&gt;<i> Evangelion AMVs/meri_vegettoex___eva___obl.mpeg'.
</I>&gt;<i>
</I>&gt;<i> The actual filename is 'Meri VegettoEX - EVA - Obligatory EVA Trailer - 
</I>&gt;<i> Deep Blue Sea Trailer Piss Take [00359A73].mpeg', and the session was 
</I>&gt;<i> also generated by the following mkisofs call (taken from the bash script 
</I>&gt;<i> I use, which works):
</I>&gt;<i>
</I>&gt;<i> =======================================================================
</I>&gt;<i>
</I>&gt;<i> /opt/schily/bin/mkisofs -volid &quot;$volumeID&quot; -rational-rock 
</I>&gt;<i> -full-iso9660-filenames -iso-level 3 -follow-links -C &quot;$(cdrskin 
</I>&gt;<i> -dev=&quot;$burner&quot; -msinfo)&quot; -M &quot;$burner&quot; -o &quot;$masteredImageOutput&quot; 
</I>&gt;<i> &quot;$directoryToMaster&quot;
</I>&gt;<i>
</I>&gt;<i> =======================================================================
</I>
It seems that you use a program (cdrskin) that is not known to be bugfree.

&gt;<i> Mounting the disc normally also produces the non-Rock Ridge filename and 
</I>&gt;<i> apparently no complaints from the isofs driver, however xorriso 
</I>&gt;<i> (<A HREF="https://www.gnu.org/software/xorriso/">https://www.gnu.org/software/xorriso/</A>) is able to list the directory 
</I>&gt;<i> and show the correct name.
</I>
xorriso is known to be not fully correct and not fully complete with respect to 
RR.

&gt;<i> Talking to the xorriso programmer over what might be happening, he 
</I>&gt;<i> reckons that due to the long filename, a CE entry is created - this 
</I>&gt;<i> should point to a block after 3066496, but actually points to block 
</I>&gt;<i> 969372 which is a data block in the first session.
</I>&gt;<i>
</I>&gt;<i> He also notes that the ISO 9660 filename does not end after 33 
</I>&gt;<i> characters in the above error, even though the length of 33 is correctly 
</I>&gt;<i> stored in the ISO 9660 directory record.
</I>&gt;<i>
</I>&gt;<i> xorriso toc output (I have added sessions beyond 3 to try to fix the 
</I>&gt;<i> filename):
</I>&gt;<i>
</I>&gt;<i> ======================================================================
</I>&gt;<i>
</I>&gt;<i> Drive current: -dev '/dev/sr0'
</I>&gt;<i> Drive type   : vendor 'ATAPI' product 'iHBS112 2' revision 'PL05'
</I>&gt;<i> Media current: BD-R sequential recording
</I>&gt;<i> Media product: JVC-AMS6/S6L/1 , JVC Limited
</I>&gt;<i> Media status : is written , is appendable
</I>&gt;<i> Media blocks : 3183328 readable , 9036064 writable , 12219392 overall
</I>&gt;<i> TOC layout   : Idx ,  sbsector ,       Size , Volume Id
</I>&gt;<i> ISO session  :   1 ,         0 ,   2899354s , ADN70
</I>&gt;<i> ISO session  :   2 ,   2899360 ,    167112s , ADN70
</I>&gt;<i> ISO session  :   3 ,   3066496 ,    116436s , ADN70
</I>&gt;<i> ISO session  :   4 ,   3182944 ,        36s , ADN70
</I>&gt;<i> ISO session  :   5 ,   3183136 ,        36s , ADN70
</I>&gt;<i> Media summary: 5 sessions, 3183328 data blocks, 6217m data, 17.2g free
</I>&gt;<i> Media nwa    : 3183328s
</I>&gt;<i>
</I>&gt;<i> ======================================================================
</I>
What do you get from cdrecord -minfo?

&gt;<i> I passed the metadata of the third session to the programmer and he 
</I>&gt;<i> reported:
</I>&gt;<i>
</I>&gt;<i> ======================================================================
</I>&gt;<i>
</I>&gt;<i> The bad CE entry says:
</I>&gt;<i>
</I>&gt;<i>    43  45  1c  01  9c  ca  0e  00  00  0e  ca  9c  00  00  00  00
</I>&gt;<i>    00  00  00  00  1a  00  00  00  00  00  00  1a
</I>&gt;<i>
</I>&gt;<i> The number 0x000eca9c is the block address (decimal 969,372) where
</I>&gt;<i> the TF field is supposed to be stored. But the session begins
</I>&gt;<i> only above the 3 millionth block. So the address below 1 million
</I>&gt;<i> must be wrong.
</I>&gt;<i>
</I>&gt;<i> I suspect it is a 32 bit byte address rollover:
</I>&gt;<i>
</I>&gt;<i> 2 exp 32 bytes is 4294967296 = 2097152 blocks of 2048.
</I>&gt;<i> session start 3066496 - wrong block number 969372 = 2097124.
</I>&gt;<i> This differs by 28 blocks. That's within our 40 blocks of
</I>&gt;<i> meta data.
</I>
This may be true. The related code has been written by Eric Youngdale in 1995,
this is before DVDs appeared and I fixed a lot of bugs in the RR Code in 2006
already, so there may be more. So far however, nobody reported a single RR bug 
since 2006.

I need to make some tests - stay tuned.

&gt;<i> ======================================================================
</I>&gt;<i>
</I>&gt;<i> He has also done a thorough investigation on whether xorriso's ability 
</I>&gt;<i> to cope with the bad CE entry is valid (i.e. should it fail with an 
</I>&gt;<i> error?), and some more testing with long filenames:
</I>&gt;<i>
</I>&gt;<i> ======================================================================
</I>&gt;<i>
</I>&gt;<i> I am examining the libisofs behaviour with the bad CE entry
</I>&gt;<i> produced by mkisofs.
</I>&gt;<i>
</I>&gt;<i> Well, the behaviour is covered by the fundamental Rock Ridge
</I>&gt;<i> rule &quot;Reader does it right&quot;.
</I>&gt;<i>
</I>&gt;<i> Explicitly SUSP 1.12 states:
</I>&gt;<i>
</I>&gt;<i> &quot;Any System Use Entry which the receiving system does not
</I>&gt;<i>    recognize shall be ignored and skipped.&quot;
</I>&gt;<i>
</I>&gt;<i> The CE entry leads to data content of a file. The first few
</I>&gt;<i> bytes of that block do not constitute a recognizable System
</I>&gt;<i> Use Entry (Rock Ridge field).
</I>&gt;<i> So it shall be ignored. And that is what libisofs does.
</I>&gt;<i>
</I>&gt;<i> If the filename is 120 characters long, then not only the
</I>&gt;<i> timestamp field TF is stored in a continuation record,
</I>&gt;<i> but also field PX, which holds POSIX permissions.
</I>&gt;<i> This field is regarded by libisofs as mandatory if Rock
</I>&gt;<i> Ridge shall be loaded.
</I>
Did you test this with a mount on Solaris?

The expected behavior is to assume default permissions in case that PX is 
missing.

&gt;<i> So with a filename of 120 characters, xorriso will fail
</I>&gt;<i> on the attempt to load the image:
</I>&gt;<i>
</I>&gt;<i>     $ echo something&gt;/tmp/x
</I>&gt;<i>     $ mkisofs -o /tmp/x.iso -iso-level 3 -graft-points -R 
</I>&gt;<i> 1234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890=/tmp/x
</I>&gt;<i>     ...
</I>&gt;<i>     $ xorriso -indev /tmp/x.iso
</I>&gt;<i>     ...
</I>&gt;<i>     libisofs: SORRY : Mandatory Rock Ridge PX entry is not present or it 
</I>&gt;<i> contains invalid values.
</I>&gt;<i>     libisofs: SORRY : Can't open dir
</I>&gt;<i>     libisofs: NOTE :&gt;  Caused by: Operation canceled
</I>&gt;<i>     libisofs: FAILURE : Operation canceled
</I>
This looks like a bug.

J&#246;rg

-- 
 EMail:<A HREF="https://lists.berlios.de/mailman/listinfo/cdrecord-support">joerg at schily.isdn.cs.tu-berlin.de</A> (home) J&#246;rg Schilling D-13353 Berlin
       <A HREF="https://lists.berlios.de/mailman/listinfo/cdrecord-support">js at cs.tu-berlin.de</A>                (uni)  
       <A HREF="https://lists.berlios.de/mailman/listinfo/cdrecord-support">joerg.schilling at fokus.fraunhofer.de</A> (work) Blog: <A HREF="http://schily.blogspot.com/">http://schily.blogspot.com/</A>
 URL:  <A HREF="http://cdrecord.berlios.de/private/">http://cdrecord.berlios.de/private/</A> <A HREF="ftp://ftp.berlios.de/pub/schily">ftp://ftp.berlios.de/pub/schily</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000894.html">[Cdrecord-support] mkisofs - Invalid rock ridge data with file in appended session with CE record past 4GB
</A></li>
	<LI>Next message: <A HREF="000896.html">[Cdrecord-support] mkisofs - Invalid rock ridge data with file in appended session with CE record past 4GB
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#895">[ date ]</a>
              <a href="thread.html#895">[ thread ]</a>
              <a href="subject.html#895">[ subject ]</a>
              <a href="author.html#895">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cdrecord-support">More information about the Cdrecord-support
mailing list</a><br>
</body></html>
