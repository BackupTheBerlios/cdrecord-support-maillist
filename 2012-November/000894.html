<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cdrecord-support] mkisofs - Invalid rock ridge data with file in appended session with CE record past 4GB
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cdrecord-support/2012-November/index.html" >
   <LINK REL="made" HREF="mailto:cdrecord-support%40lists.berlios.de?Subject=Re%3A%20%5BCdrecord-support%5D%20mkisofs%20-%20Invalid%20rock%20ridge%20data%20with%20file%20in%0A%20appended%20session%20with%20CE%20record%20past%204GB&In-Reply-To=%3C50B6802C.1010402%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000892.html">
   <LINK REL="Next"  HREF="000895.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cdrecord-support] mkisofs - Invalid rock ridge data with file in appended session with CE record past 4GB</H1>
    <B>Omega Weapon</B> 
    <A HREF="mailto:cdrecord-support%40lists.berlios.de?Subject=Re%3A%20%5BCdrecord-support%5D%20mkisofs%20-%20Invalid%20rock%20ridge%20data%20with%20file%20in%0A%20appended%20session%20with%20CE%20record%20past%204GB&In-Reply-To=%3C50B6802C.1010402%40gmail.com%3E"
       TITLE="[Cdrecord-support] mkisofs - Invalid rock ridge data with file in appended session with CE record past 4GB">omegaphil at gmail.com
       </A><BR>
    <I>Wed Nov 28 22:20:44 CET 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="000892.html">[Cdrecord-support] Debian Free Software Guidelines compatibility
</A></li>
        <LI>Next message: <A HREF="000895.html">[Cdrecord-support] mkisofs - Invalid rock ridge data with file	in appended session with CE record past 4GB
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#894">[ date ]</a>
              <a href="thread.html#894">[ thread ]</a>
              <a href="subject.html#894">[ subject ]</a>
              <a href="author.html#894">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>/opt/schily/bin/mkisofs --version

mkisofs 3.01a07 (x86_64-unknown-linux-gnu) Copyright (C) 1993-1997 Eric 
Youngdale (C) 1997-2010 Joerg Schilling

Debian Wheezy (Testing), Linux omega1 3.2.0-4-amd64 #1 SMP Debian 
3.2.32-1 x86_64 GNU/Linux


I received the following error on generating an isofs to append to a 
multisession BD-R disc:

=====================================================================

Setting input-charset to 'UTF-8' from locale.
ISO-9660 image includes checksum signature for correct inode numbers.
SUSP signatures version 1 found
Rock Ridge signatures version 1 found
Rock Ridge id 'RRIP_1991A'
BAD RR ATTRIBUTES: 11 A2 07 4A 3D 88 93 69 A5 CD 37 52 71 FD 97 71 B9 FE 
78 BE 03 E4 FA B0 C1 26
BAD RR ATTRIBUTES: ...J=..i..7Rq..q..x......&amp;
mkisofs: **BAD RRVERSION (74) in '&#65533;' field (11 A2).
mkisofs: Cannot parse Rock Ridge attributes for 
'MERI_VEGETTOEX___EVA___OBL.MPEG;1RR&#65533;NMd'.

=====================================================================

The file in question it was referring to exits at '/Neon Genesis 
Evangelion AMVs/meri_vegettoex___eva___obl.mpeg'.

The actual filename is 'Meri VegettoEX - EVA - Obligatory EVA Trailer - 
Deep Blue Sea Trailer Piss Take [00359A73].mpeg', and the session was 
also generated by the following mkisofs call (taken from the bash script 
I use, which works):

=======================================================================

/opt/schily/bin/mkisofs -volid &quot;$volumeID&quot; -rational-rock 
-full-iso9660-filenames -iso-level 3 -follow-links -C &quot;$(cdrskin 
-dev=&quot;$burner&quot; -msinfo)&quot; -M &quot;$burner&quot; -o &quot;$masteredImageOutput&quot; 
&quot;$directoryToMaster&quot;

=======================================================================

Mounting the disc normally also produces the non-Rock Ridge filename and 
apparently no complaints from the isofs driver, however xorriso 
(<A HREF="https://www.gnu.org/software/xorriso/">https://www.gnu.org/software/xorriso/</A>) is able to list the directory 
and show the correct name.

Talking to the xorriso programmer over what might be happening, he 
reckons that due to the long filename, a CE entry is created - this 
should point to a block after 3066496, but actually points to block 
969372 which is a data block in the first session.

He also notes that the ISO 9660 filename does not end after 33 
characters in the above error, even though the length of 33 is correctly 
stored in the ISO 9660 directory record.

xorriso toc output (I have added sessions beyond 3 to try to fix the 
filename):

======================================================================

Drive current: -dev '/dev/sr0'
Drive type   : vendor 'ATAPI' product 'iHBS112 2' revision 'PL05'
Media current: BD-R sequential recording
Media product: JVC-AMS6/S6L/1 , JVC Limited
Media status : is written , is appendable
Media blocks : 3183328 readable , 9036064 writable , 12219392 overall
TOC layout   : Idx ,  sbsector ,       Size , Volume Id
ISO session  :   1 ,         0 ,   2899354s , ADN70
ISO session  :   2 ,   2899360 ,    167112s , ADN70
ISO session  :   3 ,   3066496 ,    116436s , ADN70
ISO session  :   4 ,   3182944 ,        36s , ADN70
ISO session  :   5 ,   3183136 ,        36s , ADN70
Media summary: 5 sessions, 3183328 data blocks, 6217m data, 17.2g free
Media nwa    : 3183328s

======================================================================

I passed the metadata of the third session to the programmer and he 
reported:

======================================================================

The bad CE entry says:

   43  45  1c  01  9c  ca  0e  00  00  0e  ca  9c  00  00  00  00
   00  00  00  00  1a  00  00  00  00  00  00  1a

The number 0x000eca9c is the block address (decimal 969,372) where
the TF field is supposed to be stored. But the session begins
only above the 3 millionth block. So the address below 1 million
must be wrong.

I suspect it is a 32 bit byte address rollover:

2 exp 32 bytes is 4294967296 = 2097152 blocks of 2048.
session start 3066496 - wrong block number 969372 = 2097124.
This differs by 28 blocks. That's within our 40 blocks of
meta data.

======================================================================

He has also done a thorough investigation on whether xorriso's ability 
to cope with the bad CE entry is valid (i.e. should it fail with an 
error?), and some more testing with long filenames:

======================================================================

I am examining the libisofs behaviour with the bad CE entry
produced by mkisofs.

Well, the behaviour is covered by the fundamental Rock Ridge
rule &quot;Reader does it right&quot;.

Explicitly SUSP 1.12 states:

&quot;Any System Use Entry which the receiving system does not
   recognize shall be ignored and skipped.&quot;

The CE entry leads to data content of a file. The first few
bytes of that block do not constitute a recognizable System
Use Entry (Rock Ridge field).
So it shall be ignored. And that is what libisofs does.

If the filename is 120 characters long, then not only the
timestamp field TF is stored in a continuation record,
but also field PX, which holds POSIX permissions.
This field is regarded by libisofs as mandatory if Rock
Ridge shall be loaded.

So with a filename of 120 characters, xorriso will fail
on the attempt to load the image:

    $ echo something&gt;/tmp/x
    $ mkisofs -o /tmp/x.iso -iso-level 3 -graft-points -R 
1234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890=/tmp/x
    ...
    $ xorriso -indev /tmp/x.iso
    ...
    libisofs: SORRY : Mandatory Rock Ridge PX entry is not present or it 
contains invalid values.
    libisofs: SORRY : Can't open dir
    libisofs: NOTE :&gt;  Caused by: Operation canceled
    libisofs: FAILURE : Operation canceled

======================================================================
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000892.html">[Cdrecord-support] Debian Free Software Guidelines compatibility
</A></li>
	<LI>Next message: <A HREF="000895.html">[Cdrecord-support] mkisofs - Invalid rock ridge data with file	in appended session with CE record past 4GB
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#894">[ date ]</a>
              <a href="thread.html#894">[ thread ]</a>
              <a href="subject.html#894">[ subject ]</a>
              <a href="author.html#894">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cdrecord-support">More information about the Cdrecord-support
mailing list</a><br>
</body></html>
